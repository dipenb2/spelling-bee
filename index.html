<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Bangla Spelling Bee</title>
  <style>
    body {
      font-family: "Noto Sans Bengali", system-ui, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    .board {
      position: relative;
      width: 260px;
      height: 260px;
      margin: 40px auto;
    }
    .hex {
      position: absolute;
      width: 70px;
      height: 70px;
      line-height: 70px;
      border-radius: 15px;
      display: inline-block;
      background: #eeeeee;
      font-size: 32px;
      cursor: pointer;
      user-select: none;
    }
    .center {
      background: #ffd400;
      left: 95px; top: 95px;
    }
    .hex.p0 { left: 95px; top: 20px; }
    .hex.p1 { left: 175px; top: 65px; }
    .hex.p2 { left: 175px; top: 155px; }
    .hex.p3 { left: 95px; top: 200px; }
    .hex.p4 { left: 15px; top: 155px; }
    .hex.p5 { left: 15px; top: 65px; }

    #current {
      font-size: 28px;
      margin: 10px 0;
      min-height: 32px;
    }
    button {
      margin: 5px;
      padding: 6px 10px;
      font-size: 14px;
    }
    #found {
      max-width: 320px;
      margin: 15px auto;
      text-align: left;
      font-size: 16px;
    }
    #message {
      min-height: 22px;
      margin-top: 6px;
      color: #444444;
    }
    #scoreLine {
      cursor: pointer;
    }

    /* --- Rank modal --- */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
    }
    .modal-content {
      background: #ffffff;
      margin: 80px auto;
      padding: 20px;
      border-radius: 12px;
      max-width: 360px;
      text-align: left;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      font-size: 14px;
    }
    .modal-content h3 {
      margin-top: 0;
      text-align: center;
    }
    .close {
      float: right;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
    }
    #rankList {
      list-style: none;
      padding-left: 0;
      margin-top: 10px;
    }
    #rankList li {
      margin: 4px 0;
    }
  </style>
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali&display=swap">
</head>
<body>

<h2>বাংলা Spelling Bee – ডেমো</h2>
<p>শব্দ বানাও – মাঝের অক্ষরটি অবশ্যই ব্যবহার করে কমপক্ষে ৩ অক্ষরের শব্দ বানাতে হবে।</p>

<div class="board" id="board"></div>

<div id="current"></div>
<p id="scoreLine">স্কোর: <span id="score">0</span></p>
<p id="praise"></p>

<button id="delete">মুছুন</button>
<button id="shuffle">ঘোরান</button>
<button id="enter">এন্টার</button>
<button id="conjunct">যুক্তাক্ষর</button>

<div id="message"></div>

<h3>আপনি যেগুলো পেয়েছেন:</h3>
<div id="found"></div>

<!-- Rank Modal -->
<div id="rankModal" class="modal">
  <div class="modal-content">
    <span id="rankClose" class="close">&times;</span>
    <h3>Rankings</h3>
    <p id="rankSummary"></p>
    <ul id="rankList"></ul>
  </div>
</div>

<script>
// ---------- পাজল সেটআপ ----------
const puzzle = {
  center: "ক",
  letters: ["ম","ল","ত","ন","র","আ"],
  validWords: [
    "কলম", "করাত", "কতল", "নরক", "কমল", "নরক", "রক্ত",
    "কমলা",
    "কলতান",
    "করলা",
    "কালা",
    "কাম",
    "রকম",
    "কলা",
    "কান",
    "রকম",
    "মকর",
    "কাল",
    "কলাম",
    "ক্লান্ত"
  ]
};

// ---------- গ্লোবাল স্টেট ----------
let current = "";
let score = 0;
let found = [];

// আ-কার ও যুক্তাক্ষর
const AKAR_TILE = "আ";   // বাটনে যা দেখাচ্ছি
const AKAR_SIGN = "া";   // আ-কার
const HALANT   = "্";    // হসন্ত (virama)

// যুক্তাক্ষরের ম্যাপ – শুধু বাটন চাপলে কাজ করবে
// ক+ল = ক্ল, ন+ত = ন্ত, ক+ত = ক্ত
const CONJUNCTS = {
  "ক+ল": "ক্ল",
  "ন+ত": "ন্ত",
  "ক+ত": "ক্ত"
};

// ---------- বোর্ড আঁকা ----------
function renderBoard() {
  const board = document.getElementById("board");
  board.innerHTML = "";

  const centerDiv = document.createElement("div");
  centerDiv.className = "hex center";
  centerDiv.textContent = puzzle.center;
  centerDiv.onclick = () => addLetter(puzzle.center);
  board.appendChild(centerDiv);

  puzzle.letters.forEach((ch, i) => {
    const div = document.createElement("div");
    div.className = "hex p" + i;
    div.textContent = ch;
    div.onclick = () => addLetter(ch);
    board.appendChild(div);
  });
}

// ---------- অক্ষর যোগ ----------
function addLetter(ch) {
  if (ch === AKAR_TILE) {
    applyAkar();
  } else {
    current += ch;
  }
  updateCurrent();
}

function applyAkar() {
  if (!current) {
    // শুরুতে আ → "আ"
    current += AKAR_TILE;
    return;
  }
  const lastChar = current[current.length - 1];
  current = current.slice(0, -1) + lastChar + AKAR_SIGN;
}

// যুক্তাক্ষর বাটন: শেষ দুই অক্ষর দেখে ক্ল / ন্ত / ক্ত বানায়
function applyConjunctButton() {
  if (current.length < 2) {
    setMessage("কমপক্ষে দুটো বর্ণের পরে যুক্তাক্ষর লাগবে।");
    return;
  }
  const last = current[current.length - 1];
  const prev = current[current.length - 2];
  const key = prev + "+" + last;

  if (CONJUNCTS[key]) {
    current = current.slice(0, -2) + CONJUNCTS[key];
    updateCurrent();
    setMessage("যুক্তাক্ষর লাগলো ✔");
  } else {
    setMessage("এই জায়গায় যুক্তাক্ষর লাগছে না।");
  }
}

// ---------- হেল্পার ----------
function updateCurrent() {
  document.getElementById("current").textContent = current;
}

function clearCurrent(msg = "") {
  current = "";
  updateCurrent();
  setMessage(msg);
}

function setMessage(msg) {
  document.getElementById("message").textContent = msg;
}

function scoreWord(w) {
  if (w.length === 3) return 1;
  if (w.length === 4) return 2;
  return w.length;
}

function getPraiseForScore(s) {
  if (s >= 40) return "অসাধারণ!";
  if (s >= 30) return "চমৎকার!";
  if (s >= 20) return "দারুণ!";
  if (s >= 10) return "খুব ভালো!";
  if (s >= 1)  return "বাহ!";
  return "";
}

function updatePraise() {
  const p = document.getElementById("praise");
  p.textContent = getPraiseForScore(score);
}

// মোট সম্ভব স্কোর (শুধু তথ্যের জন্য)
const TOTAL_POSSIBLE = puzzle.validWords.reduce(
  (sum, w) => sum + scoreWord(w), 0
);

// আমাদের বাংলা র‍্যাঙ্ক সিস্টেম (নির্দিষ্ট স্কোরে)
const rankLevels = [
  { name: "শুরু",     minScore: 0 },
  { name: "বাহ্",     minScore: 1 },
  { name: "খুব ভালো", minScore: 10 },
  { name: "দারুণ",    minScore: 20 },
  { name: "চমৎকার",  minScore: 30 },
  { name: "অসাধারণ", minScore: 40 }
];

// ---------- র‍্যাঙ্ক মডাল ----------
function showRankModal() {
  const modal = document.getElementById("rankModal");
  const listEl = document.getElementById("rankList");
  const summaryEl = document.getElementById("rankSummary");

  // বর্তমান র‍্যাঙ্ক বের করি (minScore অনুযায়ী)
  let currentRank = rankLevels[0];
  for (const lvl of rankLevels) {
    if (score >= lvl.minScore) currentRank = lvl;
  }
  const idx = rankLevels.indexOf(currentRank);
  const nextRank = (idx + 1 < rankLevels.length) ? rankLevels[idx + 1] : null;

  // Summary
  let summary = `এই পাজলে মোট সম্ভব স্কোর ${TOTAL_POSSIBLE}। `;
  summary += `আপনার বর্তমান র‍্যাঙ্ক: ${currentRank.name} (${score} পয়েন্ট)।`;
  if (nextRank) {
    const diff = Math.max(0, nextRank.minScore - score);
    summary += ` পরের র‍্যাঙ্ক “${nextRank.name}” পেতে ন্যূনতম ${nextRank.minScore} পয়েন্ট, অর্থাৎ আরও ${diff} পয়েন্ট প্রয়োজন।`;
  } else {
    summary += ` আপনি ইতিমধ্যে সর্বোচ্চ র‍্যাঙ্কে আছেন!`;
  }
  summaryEl.textContent = summary;

  // তালিকা (উপর থেকে নিচে: অসাধারণ → শুরু)
  listEl.innerHTML = "";
  const desc = [...rankLevels].reverse();
  desc.forEach(lvl => {
    const li = document.createElement("li");
    li.textContent = `${lvl.name} — ন্যূনতম ${lvl.minScore} পয়েন্ট`;
    if (lvl.name === currentRank.name) {
      li.style.fontWeight = "bold";
    }
    listEl.appendChild(li);
  });

  modal.style.display = "block";
}

function hideRankModal() {
  document.getElementById("rankModal").style.display = "none";
}

// ---------- সাবমিট ----------
function submitWord() {
  const w = current;

  if (w.length < 3) {
    clearCurrent("কমপক্ষে ৩ অক্ষর হতে হবে।");
    return;
  }

  if (!w.includes(puzzle.center)) {
    clearCurrent("মাঝের অক্ষরটি থাকতে হবে!");
    return;
  }

  const allowed = new Set([puzzle.center, ...puzzle.letters]);
  if (allowed.has(AKAR_TILE)) {
    allowed.add(AKAR_SIGN);
  }
  allowed.add(HALANT);

  for (const ch of w) {
    if (!allowed.has(ch)) {
      clearCurrent("এই অক্ষর ব্যবহার করা যাবে না: " + ch);
      return;
    }
  }

  if (!puzzle.validWords.includes(w)) {
    clearCurrent("ডিকশনারিতে এই শব্দ নেই।");
    return;
  }

  if (found.includes(w)) {
    clearCurrent("এই শব্দটি আগেই পাওয়া হয়েছে।");
    return;
  }

  // স্কোর আপডেট ও কমেন্ট
  found.push(w);
  score += scoreWord(w);
  document.getElementById("score").textContent = score;
  updatePraise();
  document.getElementById("found").textContent = found.join(", ");

  const praise = getPraiseForScore(score);
  clearCurrent(praise ? praise + " ✔" : "ঠিক আছে ✔");
}

// ---------- বাটন হ্যান্ডলার ----------
document.getElementById("delete").onclick = () => clearCurrent();
document.getElementById("shuffle").onclick = () => {
  puzzle.letters.sort(() => Math.random() - 0.5);
  renderBoard();
};
document.getElementById("enter").onclick = submitWord;
document.getElementById("conjunct").onclick = applyConjunctButton;

// স্কোর লাইনে ক্লিক করলে র‍্যাঙ্ক মডাল
document.getElementById("scoreLine").onclick = showRankModal;
document.getElementById("rankClose").onclick = hideRankModal;
window.onclick = function(e) {
  const modal = document.getElementById("rankModal");
  if (e.target === modal) hideRankModal();
};

// প্রথমবার বোর্ড রেন্ডার
renderBoard();
</script>

</body>
</html>
